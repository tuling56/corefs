user  root root;
worker_processes  8;
worker_cpu_affinity  00000001 00000010 00000100 00001000 00010000 00100000 01000000 10000000;
worker_rlimit_nofile  65535;

events {
    use epoll;
    worker_connections  65535;
}


http {
        include       mime.types;
        default_type  application/octet-stream;

        log_format  mylog  '$remote_addr - $remote_user [$time_local] "$request" '
                           '$status $body_bytes_sent "$http_referer" '
                           '"$http_user_agent" "$http_x_forwarded_for"'
                           '"$request_time" "$upstream_response_time"';

        access_log off;

        sendfile        on;
        tcp_nopush  on;
        keepalive_timeout  65;
        tcp_nodelay on;
        ssi on;
        ssi_silent_errors on;
        ssi_types text/shtml;
        client_max_body_size 10m;
        expires 12h;
        gzip on;
        gzip_min_length  1024;
        gzip_buffers     4 8k;
        gzip_http_version 1.1;
        gzip_types       text/plain application/x-javascript text/css application/xml;

    server {
        listen 80 default;
        server_name _;
        return 500;
    }

    lua_package_path "/usr/local/lib/lua/5.1/?.lua;/usr/local/nginx/lua/luacomm/?.lua;";

    server {
        listen    80;
        server_name    xvrvip.v.xunlei.com;

        location /getprice {
            error_log logs/xvrvip_getprice.log debug;
            content_by_lua_file lua/vip/getprice.lua;
        }

        location /buyrecord{
            error_log logs/xvrvip_buyrecord.log debug;
            content_by_lua_file lua/vip/buyrecord.lua;
        }

        location /usrgame{
            error_log logs/xvrvip_accountinfo.lua.log debug;
            content_by_lua_file lua/vip/accountinfo.lua;
        }

        location /buydetails{
            error_log logs/xvrvip_buydetails.log debug;
            content_by_lua_file lua/vip/buydetails.lua;
        }

        location /goodsprice{
            error_log logs/xvrvip_goodsprice.log debug;
            content_by_lua_file lua/vip/goodsprice.lua;
        }

        location /paycallback{
            error_log logs/xvrvip_paycallback.log debug;
            content_by_lua_file lua/vip/paycallback.lua;
        }

        location /getgoods{
            error_log logs/xvrvip_getgoods.log debug;
            content_by_lua_file lua/vip/privateurl.lua;
        }

        location /neworder{
            error_log logs/xvrvip_neworder.log debug;
            content_by_lua_file lua/vip/neworder.lua;
        }

        location /download{
            error_log logs/xvrvip_download.log debug;
            content_by_lua_file lua/vip/download.lua;
        }
    }

    server {
        listen    80;
        server_name    xvrmedia.v.xunlei.com;
        #lua_code_cache off;
        charset utf-8;
        location /android/list {
            error_log logs/xvr_list.log debug;
            content_by_lua_file lua/android/list.lua;
        }

        location /android/info {
            error_log logs/xvr_info.log debug;
            content_by_lua_file lua/android/info.lua;
        }

        location /android/packageinfo {
            error_log logs/xvr_packageinfo.log debug;
            content_by_lua_file lua/android/packageinfo.lua;
        }

        location /android/relations {
            error_log logs/xvr_relations.log debug;
            content_by_lua_file lua/android/relations.lua;
        }

        location /android/sublist {
            error_log logs/xvr_sublist.log debug;
            content_by_lua_file lua/android/sublist.lua;
        }
        location /android/albuminfo {
            error_log logs/xvr_albuminfo.log debug;
            content_by_lua_file lua/android/albuminfo.lua;
        }

        location /android/albumlist {
            error_log logs/xvr_albumlist.log debug;
            content_by_lua_file lua/android/albumlist.lua;
        }
        location /android/banner {
            error_log logs/xvr_banner.log debug;
            content_by_lua_file lua/android/banner.lua;
        }

        location /android/search {
            error_log logs/xvr_search.log debug;
            content_by_lua_file lua/android/search.lua;
        }
    }

    server {
        listen    80;
        server_name    editxvr.v.xunlei.com;

        location / {
            include uwsgi_params;
            uwsgi_pass 127.0.0.1:8000;
        }
    }

    server {
        listen    80;
        server_name    playxvr.v.xunlei.com;

        location / {
            sendfile    on;
            tcp_nodelay    on;
            charset utf-8;
            root   /usr/local/xvr/data;
        }
    }

    server {
        listen    80;
        server_name    xvrsign.v.xunlei.com;
        root /usr/local/xvr/data/sign;

        location /sign {
            error_log logs/sign.log debug;
            content_by_lua_file lua/sign/signgearvr.lua;
        }
    }

    server {
                listen  80;
                server_name     backxvrsign.v.xunlei.com;

                location / {
                        include uwsgi_params;
                        uwsgi_pass 127.0.0.1:8000;
                }
        }

    server {
                listen  80;
                server_name     videoinfo.v.xunlei.com;
                location / {
                        include uwsgi_params;
                        uwsgi_pass 127.0.0.1:8000;
                }
        }

    server {
                listen  80;
                server_name     audit_svideo.v.xunlei.com;

                location / {
                        include uwsgi_params;
                        uwsgi_pass 127.0.0.1:8000;
                }
        }

    server {
                listen  80;
                server_name     playsvideo.v.xunlei.com;

                location / {
                        sendfile        on;
                        tcp_nodelay     on;
                        charset utf-8;
                        root   /var/flvs;
                }
        }

    server {
                listen  80;
                server_name     xunlei.addnum.com;
            root /usr/local/vod/test;

                location / {
                        include uwsgi_params;
                        uwsgi_pass 127.0.0.1:8000;
            # root /usr/local/vod/test;
            # uwsgi_param UWSGI_CHDIR /usr/local/vod/test;
                }
        location /static {
            alias /usr/local/vod/test/static;
            access_log off;
            expires 10d;
            break;
        }
        }

    server {
        listen       80;
        server_name  10.10.160.11;
        root  /usr/local/vod/svideo/videoata/;
        limit_rate_after 5m;    ####在flv视频文件下载了5M以后开始限速
        limit_rate 2m;        ####速度限制
        index   index.html;
        charset utf-8;

        location ~ \.flv
        {
            flv;
        }
    }


    server {
        listen       8089;        #端口号
        server_name  10.10.160.11;    #本机
        charset utf-8;
            location ~ .*\.(gif|jpg|jpeg|png)$
        {
            expires 24h;
            root /usr/local/vod/svideo/videoata/;#指定图片存放路径
            access_log /usr/local/vod/svideo/videoata/log_test.log;
            proxy_store off;
            proxy_redirect          off;
         }
    }

    server {
        listen       80;
        server_name  backend.v.xunlei.com;

        location / {
            root  /data/web;
        }
        #lua_code_cache off;

        location ^~ /kankan/{
            error_log logs/kankan.log debug;
            default_type 'text/html';
            content_by_lua_file  lua/media_lua/kankan.lua;
        }
    }


    include vhosts/*.conf;        # 包含vhost目录下的虚拟主机配置
}
